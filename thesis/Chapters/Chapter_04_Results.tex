\chapter{Results}\label{ch:results}

%\section{General features of the simulated data}\label{sec:general-features-of-the-simulated-data}
%
%The NMM is configured to simulate data with a step-size of $1 ms$, yielding a $1000 Hz$ signal.
%In its initial state, the system reacts with high-amplitude oscillations to the "disturbance" of the random input.
%However, the signal usually stabilizes quickly and exhibits the expected behaviour.
%Thus, the first few seconds (stabilization-time varies with parameterization) of simulated data
%are always discarded before further analysis.
%When generating data continuously (without re-initialization of the state-variables),
%this problem only occurs once in the very beginning.
%Changing system parameters abruptly during simulation can also result in disturbances and destabilize the
%signal.

% phasendiagram

%propofol-region/vs nicht propofol region
%yapunov kooefizienten, fractale dimension der attraktoren
%chaotische regionen -> welche dimensionen werden ``gedehnt'' oder ``gestaucht''


% hypothese -> dynamische rahmenbedingen, analyse k√∂nnen bewusstsein nicht erfassen, aber notwendige rahmenbedingungen

% muster in wechsel zwischen rahmenbedingungen erkennen

%
%\begin{figure}[H]
%    \centering
%    \begin{tikzpicture}
%        \pgfplotsset{
%        %% Axis
%            scale only axis,
%            width=0.4\linewidth,
%            height=4cm,
%            every axis/.append style={
%                line width=1pt,
%                tick style={line width=0.8pt},
%                %   grid style={dashed, black!20},
%                %  grid=major,
%            },
%%               %% X-Axis
%            xmin=-0.1,
%            xmax=7,
%        }
%        \begin{groupplot} [
%                group style={
%                    group size=2 by 2,
%                    vertical sep=12mm,
%                    horizontal sep=12mm,
%                },
%                yticklabel style={
%                    /pgf/number format/fixed,
%                    /pgf/number format/precision=2
%                },
%                legend style={nodes={scale=0.8, transform shape}, thin},
%                legend image post style={scale=0},
%            ]
%            \nextgroupplot[ylabel=$mV$, xlabel=$s$]
%            \addplot [line width=.5pt,solid, cyan]
%            table[x=x,y=y ,col sep=comma]{data/methodology/uncut.csv};
%            \legend{\textbf{A)} uncut data};
%
%            \nextgroupplot[xmin=3.0, xlabel=$s$]
%            \addplot [line width=.5pt,solid, cyan]
%            table[x=x,y=y ,col sep=comma]{data/methodology/uncut.csv};
%            \legend{\textbf{B)} cut data};
%
%            \nextgroupplot[xmax=30.0, ylabel=$dB$, xlabel=$Hz$]
%            \addplot [line width=.5pt,solid, cyan]
%            table[x=x,y=y ,col sep=comma]{data/methodology/psd_welch_jr.csv};
%            \legend{\textbf{C)} J-R PSD};
%
%            \nextgroupplot[xmax=30.0, xlabel=$Hz$]
%            \addplot [line width=.5pt,solid, cyan]
%            table[x=x,y=y ,col sep=comma]{data/methodology/psd_welch_df.csv};
%            \legend{\textbf{D)} D\&F PSD};
%
%        \end{groupplot}
%    \end{tikzpicture}
%
%    \caption{
%        \textbf{Processing of simulated data.} \\
%        \textbf{A) \& B):} removing initially unstable signal by cutting off the first $3s$ of the
%        data (generated by Simple Jansen-Rit Model with $C=135$.). \\
%        \textbf{C) \& D):} Power Spectral Density of Jansen-Rit and David \& Friston Model (Welch's Method)
%    }
%    \label{fig:initial_oscilations}
%\end{figure}
%
%\section{The finally used model}\label{sec:the-finally-used-model}
%
%\begin{figure}[H]
%\input{Chapters/Chapter_02_Technical_Concepts/tikz/df_block_pyrates}
%\caption{\textbf{David \& Friston Block Diagram as implemented in PyRates}}
%\label{fig:pyratesDFBlock}
%\end{figure}
%
%For the final analysis, we use the David \& Friston Model with 2 subpopulations for each PSP-Block.
%The parameters for the subpopulations are defined as follows:
%\begin{gather*}
%    \text{slow subpopulations:}\quad \tau_{e_1}=10.8ms, \tau_{i_1}=22ms\\
%    \text{fast subpopulations:}\quad \tau_{e_2}=4.6ms, \tau_{i_2}=2.9ms\\
%\end{gather*}
%

\section{Research Results}

\subsection{Units for propofol concentration}
Some papers cite propofol concentrations in $\SI{}{\frac{\micro\gram}{\milli\litre}}$,
while others use $\SI{}{\micro\molar}$ (micromolar = $\SI{}{\frac{\micro\mol}{\litre}}$).
To get comparable numbers, we first need to establish the following relation for Propofol (molar mass: $\SI{178
.27}{\gram}$):
\[ \SI{1}{\frac{\micro\gram\hspace{0.5em}\text{\tiny{Propofol}}}{\milli\litre}}  =
\frac{ \SI{1}{\frac{\micro\gram}{\milli\litre}}}{\SI{178.27}{\frac{\gram}{\mol}}} = \SI{5.609}{\micro\molar} \]
In this work, we will settle on $\SI{}{\micro\molar}$
and only mention values in $\SI{}{\frac{\micro\gram}{\milli\litre}}$ where they are taken from a source,
but then provide the converted value as well.


\subsection{Realistic propofol concentrations during general anaesthesia (GA)}\label{subsec:realistic-prop-conc-during-ga}

During GA, effect-site concentrations ($c_{e}$, concentration near the synaptic receptors) of propofol may easily range
up to
$\SI{5}{\frac{\micro\gram}{\milli\litre}} (\approx\SI{28}{\micro\molar})$.
Loss of Consciousness (LOC) occurs on average at $c_e \sim\SI{2.0}{\frac{\micro\gram}{\milli\litre}} (\approx\SI{11
.2}{\micro\molar})$,
while the Return of Consciousness (ROC) averages at $c_e \sim\SI{1.8}{\frac{\micro\gram}{\milli\litre}}
(\approx\SI{10.1}{\micro\molar})$.
Both values may vary substantially for individual subjects.
LOC has a strong tendency to occur at higher concentrations than ROC~\cite{iwakiri_individual_2005,
    ferreira_patterns_2020}.
Throughout GA, effect-site concentration is commonly derived from measured
blood-plasma concentration ($c_p$) using more or less complex Pharmacokinetic (PK)-Models
(e.g.\ ~\cite{eleveld_general_2014, liang_pharmacokinetics-neural_2015}),
as direct measurement is impractical for obvious reasons.
Since our model will work with $c_{e}$ directly, we will disregard this for now - however, it should be kept in mind.


\subsection{Effects of propofol on the IPSP}

Research on the effect of propofol on the IPSC (Inhibitory Post-Synaptic Current) and EPSC
has shown that propofol strongly affects the IPSP decay time \cite{kitamura_effects_2003, mcdougall_propofol_2008}.
The EPSP and the amplitude of the IPSP are unaffected by propofol.
Effect-site concentrations at clinically relevant levels increase the IPSP decay time
significantly (e.g.\ around $\SI{10}{\micro\molar}$ the decay time roughly doubles)~\cite{kitamura_effects_2003}.

Using the data-points from~\cite{kitamura_effects_2003}
and assuming a very rough manual logarithmic fit (see Fig.~\ref{fig:lambda_fit}),
the function
        \[ \mathscr{D}(c_{e}) = 0.65*ln((c_{e}/2)+1)+1 \]
will be used to calculate the decay-time factor $\lambda$ from a given
effect-site concentration in $\SI{}{\micro\molar}$.

As there unfortunately were only a few data-points (and none above $\SI{10}{\micro\molar}$,
leaving a large part of the relevant parameter space empty),
a computational model-fit might have over-valued those points.
A visually fitted logarithmic function (assuming eventual effect saturation) seemed like a sensible choice
for this use-case.
However, since inter-subject variations are substantial in any case,
the exact values do not matter as much as the order of magnitude.


\begin{figure}[H]
    \centering
    \pgfplotsset{compat = newest}
    \begin{tikzpicture}
        \begin{axis}
            [
            xmin = 0, xmax = 32,
            ymin = 1, ymax = 3.5,
            xlabel = {$c_{e} (\SI{}{\micro\molar})$},
            ylabel = {$\lambda$},
            legend pos=north east,
            domain = 0:32,
            samples = 50,
            smooth,
            thick,
            scatter/classes={a={mark=o,draw=black}, b={mark=x,draw=black}}
            ],
            %\addplot[dashed, gray]{3.8*ln((x/18)+1)+1};
            %\addplot[gray       ]{0.5*ln((x)+1)+1};
            \addplot[dashed,gray]{0.65*ln((x/2)+1)+1};
            \legend{\small$\mathscr{D}(c_{e})$};
            %\addplot[green]{0.9*ln((x/4)+1)+1};
            %\addplot[red]{1.15*ln((x/4)+1)+1};
            \addplot[scatter,only marks,scatter src=explicit symbolic] table[meta=label] {
                x y label
%                0 1 a
%                0.3 1.1 a
%                1 1.5 a
%                3 1.8 a
%                10 2.8 a
%                30 5.0 a
                0.1 1.1 b
                0.3 1.2 b
                1 1.4 b
                3 1.5 b
                10 2 b
                };

                %\draw [gray, dotted] (axis cs:0,2.5) -- (axis cs:18.1,2.5)-- (axis cs:18.1,0);
        \end{axis}
    \end{tikzpicture}

    \caption{very rough manual logarithmic fit of decay-time factor to measured values
    from~\cite{kitamura_effects_2003}.}
    \label{fig:lambda_fit}
\end{figure}


\subsection{Hysteresis of propofol}
If the state of a system depends not only on its parameters, but also the systems history,
this dependency is called hysteresis.
The human body often reacts differently to the same concentration of a drug,
depending on whether the concentration is rising or decaying.
Hysteresis is well documented during propofol-induced GA~\cite{kuizenga_quantitative_1998,
    iwakiri_individual_2005,
    sepulveda_evidence_2018,ferreira_patterns_2020, su_hysteresis_2020}.
The most prominent effect being a counter-clockwise hysteresis for LOC and ROC (as mentioned
in~\ref{subsec:realistic-prop-conc-during-ga}).
The effects on responsiveness of subjects usually start at higher concentrations than they end.
While some of that effect might be caused by inaccurate PK-Models,
misgauging the actual effect-site concentration,
there is a growing body of research that supports the notion that the observed effect is independent of
pharmacokinetic interference~\cite{hutt_progress_2011, su_hysteresis_2020}.
% Therories of reasons: - re-initiation more complex than shutdown, phase-transitions

\begin{figure}[H]
    \centering
    \pgfplotsset{compat = newest}
    \begin{tikzpicture}
        \begin{axis}
            [
            xmin = 0, xmax = 1,
            ymin = 0, ymax = 1,
            xlabel = {drug concentration},
            ylabel = {observed effect},
            ],
            \node[circle, scale=0.4, draw=red] (I1) at (axis cs:0.3,0.2) {};
            \node[circle, scale=0.4, draw=red] (I2) at (axis cs:0.6,0.4) {};
            \node[circle, scale=0.4, draw=black] (I3) at (axis cs:0.8,0.8) {};

            \node[circle, scale=0.4, draw=green] (E1) at (axis cs:0.6,0.7) {};
            \node[circle, scale=0.4, draw=green] (E2) at (axis cs:0.3,0.4) {};

            \draw [ dotted, -stealth] (axis cs:0,0) -- (I1) ;
            \draw [ dotted, -stealth] (I1) -- (I2)
            node[midway, right,font=\tiny]{induction};
            \draw [dotted, -stealth] (I2) -- (I3);

            \draw [dashed, -stealth] (I3) -- (E1) ;
            \draw [dashed, -stealth] (E1) -- (E2)
            node[midway, left, font=\tiny]{emergence};
            \draw [dashed, -stealth] (E2) -- (axis cs:0.0,0.0);
        \end{axis}
    \end{tikzpicture}

    \caption{Example of counter-clockwise drug hysteresis}
    \label{fig:hystersis_in_general}
\end{figure}




\subsection{Biphasic Effect}

A biphasic effect (an initial increase of an effect, that decreases with higher concentrations) in the EEG can be
observed for many sedatives \cite{kuizenga_quantitative_1998, kuizenga_biphasic_2001}.
For propofol, a temporary steep increase in EEG amplitude in the 2--20 Hz ranges, loosely correlated with the onset of
LOC, as well as ROC can be observed.
% Stage-transition, unstable area between two stable states (consciousness/unconsciousness)


\section{Simulating Propofol in the System}\label{sec:simulating-propofol-in-the-system}

To simulate the effects of propofol on the GABA\textsubscript{A}  receptors,
the IPSP (inhibitory response function $h_i$) time-constant $\tau_i$ is increased by a factor
$\lambda$~\cite{hutt_effects_2010}:


\[ h_i(t)=\frac{H_i}{\lambda \cdot \tau_i}te^{-\frac{1}{\lambda \cdot \tau_i}} \]
The effect of increasing $\lambda$ for $h_{i_1}$ and $h_{i_2}$ is visualized in Fig.~\ref{fig:PSPInhibLongPlot}.


\begin{figure}[H]
    \centering
    \pgfplotsset{compat = newest}
    \begin{tikzpicture}
        \begin{axis}
            [
            xmin = -1, xmax = 280,
            ymin = 0, ymax = 58.1,
            xlabel = {$t$ ($ms$)},
            ylabel = {$h$ ($mV$)},
            legend pos=north east,
            legend style={nodes={scale=0.8, transform shape}},
            domain = 0:280,
            samples = 200,
            smooth,
            thick,
            ],
            \addplot[red] {(20/22)*x*e^(-(1/22)*x)};\label{plot:psp3}
            \addplot[orange] {(151.72/2.9)*x*e^(-(1/2.9)*x)};\label{plot:psp4}
            \addplot[red, dash dot] {(20/44)*x*e^(-(1/44)*x)};\label{plot:psp5.10}
            \addplot[red, dashed] {(20/66)*x*e^(-(1/66)*x)};\label{plot:psp5.15}

            \addplot[orange, dotted]{(151.72/5.8)*x*e^(-(1/5.8)*x)};\label{plot:psp6.10}
            \addplot[orange, dashed] {(151.72/8.7)*x*e^(-(1/8.7)*x)};\label{plot:psp6.15}
            \coordinate (legend) at (axis description cs:0.97,0.97);
        \end{axis}
        \tiny
        \matrix [
            draw,
            matrix of nodes,
            anchor=north east,
        ] at (legend) {

            & $\tau$ &    $H$  \\
            $h_{i_1}(t)$~\ref{plot:psp3} & 22.0ms &  20.0mV \\
            $h_{i_1}(t)$~\ref{plot:psp5.10} & 44.0ms &  20.0mV \\
            $h_{i_1}(t)$~\ref{plot:psp5.15} & 66.0ms &  20.0mV \\
            $h_{i_2}(t)$~\ref{plot:psp4} &  2.9ms & 151.7mV \\
            $h_{i_2}(t)$~\ref{plot:psp6.10} &  5.8ms & 151.7mV \\
            $h_{i_2}(t)$~\ref{plot:psp6.15} &  8.7ms & 151.7mV \\
        };
    \end{tikzpicture}

    \caption{\textbf{Inhibitory PSP functions with varying $\lambda$:} \\
        The duration of the effect increases while the amplitude stays
        constant, effectively increasing the charge transfer. ($\lambda$ in [1.0 (no drug-effect, solid lines),
        2.0 (dotted), 3.0 (dashed)])
    }
    \label{fig:PSPInhibLongPlot}
\end{figure}
Varying $\lambda$ between $1$ ($\SI{0}{\micro\molar}$) and $3.0$ ($\sim\SI{30}{\micro\molar}$) appears to be a
sensible choice for the clinically relevant range, given Fig.~\ref{fig:lambda_fit}.

\section{Simulating over the parameter space}

When simulating over the selected parameter space $ \lambda \in \left[ 1, 3 \right] $ (see Fig~\ref{fig:sedation_sim}
\textbf{A}),
the following phenomena can be observed:

\begin{enumerate}
    \item Steadily inreasing $ \lambda $, from $1.0$ first leads to a slight decrease in signal voltage, while roughly
    maintaining
    oscillation-amplitude (Fig~\ref{fig:sedation_sim} \textbf{B}).
    Additionally, the dominant frequencies from the $ 10-12 \SI{}{\hertz} $ range slowly shift towards $ 5-10
    \SI{}{\hertz} $ (\textbf{C}).
    Overall the system appears to be in a stable state.

    \item Starting from $ \lambda \sim 1.85 $, the system enters an unstable state, oscillating heavily and dramatically
    increasing signal amplitude and frequency amplitudes below $ \SI{25}{\hertz} $.
    Further increasing $\lambda$ has the same minimal effects on the disturbed signal,
    as the increase had before exiting the stable state.

    \item At $\lambda \sim 2.05 $, the disturbances disappear again, with the system having apparently reached a different
    stable state at visibly lower voltage.
    The dominant frequencies have jumped below $\SI{10}{\hertz}$.

    \item Up to $\lambda = 3.0$, the signal voltage slowly continues to decrease as before,
    however the frequency distribution appears to have settled.
    Maintaining peak dosage has no further effects.

    \item Decreasing from $\lambda = 3.0$ has the expected reverse effect: only the signal voltage increases as well.

    \item At $\lambda \sim 1.95$ (somewhat lower than $2.05$!), disturbances begin to form again.
    The system undergoes similar effects in reverse as it did in the other direction.
    Noteworthy is however, that the unstable state prevails until $\lambda$ reaches $\sim 1.48$.
   % creating a distinct parallel to the hysteresis-effects observed during GA.
\end{enumerate}




\begin{figure}[H]

\begin{tikzpicture}
\pgfplotsset{
        %% Axis
            scale only axis,
            width=0.9\linewidth,
            height=3cm,
            every axis/.append style={
                line width=1pt,
                tick style={line width=0.8pt},
                %   grid style={dashed, black!20},
                %  grid=major,
            },
%               %% X-Axis
            xmin=0.899, xmax=65.0,% xmax=38.899,
        }
        \begin{groupplot} [
                group style={
                    group size=1 by 3,
                    vertical sep=2mm,
                    xlabels at=edge bottom,
                    xticklabels at=edge bottom,
                },
                yticklabel style={
                    /pgf/number format/fixed,
                    /pgf/number format/precision=2
                },
                legend style={nodes={scale=0.8, transform shape}, thin},
                legend image post style={scale=0},
                xlabel=$t(s)$
            ]
            \nextgroupplot[ylabel style={align=center}, ylabel=\begin{tiny}decay-time factor\end{tiny}\\ $\lambda$,
                           ymin=1, ymax=3.1, grid style={dashed,black!20}, grid=major]
            \addplot [line width=.5pt,solid, cyan]
            table[x=x,y=y ,col sep=comma]{data/full_sedation_sim/linear_factors.csv};
                \draw [red, dotted] ([xshift=0.0cm]axis cs:0,1.85) -- ([yshift=0.0cm]axis cs:13.6,1.85) ;
                \draw [red, dotted] ([xshift=0.0cm]axis cs:0,2.05) -- ([yshift=0.0cm]axis cs:16.8,2.05) node[near end,
                        above,font=\tiny]{LOC};
                \draw [red, dotted] ([xshift=0.0cm]axis cs:16.8,1) -- ([yshift=0.0cm]axis cs:16.8,2.05);
                \draw [red, dotted] ([xshift=0.0cm]axis cs:13.6,1) -- ([yshift=0.0cm]axis cs:13.6,1.85);

                \draw [green, dotted] ([xshift=0.0cm]axis cs:65.0,1.48) -- ([yshift=0.0cm]axis cs:57.5,1.48) ;
                \draw [green, dotted] ([xshift=0.0cm]axis cs:65.0,1.95) -- ([yshift=0.0cm]axis cs:51.5,1.95) node[near
                       end,above,font=\tiny]{ROC};
                \draw [green, dotted] ([xshift=0.0cm]axis cs:51.5,1) -- ([yshift=0.0cm]axis cs:51.5,1.95);
                \draw [green, dotted] ([xshift=0.0cm]axis cs:57.5,1) -- ([yshift=0.0cm]axis cs:57.5,1.48);
            \legend{\textbf{A)} propofol concentration};

            \nextgroupplot[ylabel=$mV$]
            \addplot [line width=.5pt,solid, cyan]
            table[x=x,y=y ,col sep=comma]{data/full_sedation_sim/linear.csv};

            \legend{\textbf{B)} signal};

            \nextgroupplot[ymin=0, ymax=40,
                            ylabel=$Hz$,
                            height=5cm
            ]
              \addplot graphics [includegraphics cmd=\pgfimage,
        xmin=0.0,%xmin=0.899,
        xmax=65.0,% xmax=38.899,
        ymin=0, ymax=40]
            {data/full_sedation_sim/linear-img0.png};
            \legend{\textbf{C)} spectrogram};

        \end{groupplot}
     \begin{groupplot} [group style={group size=1 by 3,vertical sep=2mm}]
            \nextgroupplot[axis y line=right, ymin=1, ymax=3.1, ylabel=$\sim c_e (\SI{}{\micro\molar})$,
            yticklabels ={0,5,10,20,30}, ytick={1,1.81,2.164,2.558,2.8},
            axis x line=none]
            \nextgroupplot[axis y line=none, axis x line=none]
            \nextgroupplot[axis y line=none, ymin=0, ymax=40,height=5cm,axis x line=none]
        \end{groupplot}

\end{tikzpicture}
\caption{\textbf{Simulation of a sedation:} \\
        \textbf{A):} timeline of the simulated IPSP stretch factor $\lambda$ (roughly representing $c_e$) \\
        \textbf{B):} timeline of the simulated signal \\
        \textbf{C):} spectrogram
}\label{fig:sedation_sim}
\end{figure}

\section{Discussion}

While the NMM used for simulation is a very rough abstraction of cortical dynamics,
multiple parallels to effects observed during GA can be drawn:

\begin{enumerate}

    \item Two, distinguishable \textbf{stable states} can be observed.
    The frequency changes bear strong similarities to the switch to unconsciousness in GA
    \cite{purdon_electroencephalogram_2013, ni_mhuircheartaigh_slow_wave_2013}.
    \item Induction and Emergence are asymmetrical (\textbf{hysteresis}).
    The system predicts that the state-change `LOC` occurs at higher concentrations than `ROC`.

    \item During state transitions, there is a strong \textbf{biphasic effect}.
    The system predicts that the frequency range below $\SI{25}{\hertz}$ receives a temporary amplitude boost during
    the phase transitions, which disappears while the parameter changes continue in the same direction.
    \item In the `unconscious` state, frequency distribution stabilizes independent of further increasing decay-time
    (\textbf{slow-wave-activity saturation}?~\cite{ni_mhuircheartaigh_slow_wave_2013}).

\end{enumerate}


\todo{elaborate on all of the above...}
\todo{draw parallels to~\cite{hutt_progress_2011}, which discusses mainly the same effects,
    although with a different NMM (or `mean-field-model`)...}